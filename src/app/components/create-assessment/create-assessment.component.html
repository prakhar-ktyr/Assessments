<div class="container mt-4">
    <button mat-raised-button (click)="isLinear = !isLinear" id="toggle-linear">
      {{!isLinear ? 'Enable linear mode' : 'Disable linear mode'}}
    </button>
    <mat-horizontal-stepper [linear]="isLinear" #stepper>
      <mat-step [stepControl]="assessmentForm" label="Assessment Details">
        <form [formGroup]="assessmentForm" (ngSubmit)="saveFirstStepData(assessmentForm)">
          <mat-form-field appearance="fill">
            <mat-label>Assessment Name</mat-label>
            <input matInput placeholder="Assessment Name" formControlName="name" required>
            <mat-error *ngIf="assessmentForm.get('name')?.hasError('required')">Name is required.</mat-error>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Description</mat-label>
            <textarea matInput placeholder="Description" formControlName="description" required></textarea>
            <mat-error *ngIf="assessmentForm.get('description')?.hasError('required')">Description is required.</mat-error>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Assessment Image</mat-label>
            <input matInput placeholder="Image Path" formControlName="assessmentImage" required>
            <mat-error *ngIf="assessmentForm.get('assessmentImage')?.hasError('required')">Image Path is required.</mat-error>
          </mat-form-field>
          <div>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="questionsForm" label="Questions">
        <form [formGroup]="questionsForm" (ngSubmit)="saveSecondStepData(questionsForm)">
          <div formArrayName="questions" class="mt-4">
            <div *ngFor="let question of questionControls; let i = index" [formGroupName]="i" class="mb-4 p-3 border rounded">
              <mat-form-field appearance="fill">
                <mat-label>Question Text</mat-label>
                <input matInput placeholder="Question Text" formControlName="text" required>
                <mat-error *ngIf="question.get('text')?.hasError('required')">Question Text is required.</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Question Type</mat-label>
                <mat-select formControlName="type" required>
                  <mat-option value="multiple-choice">Multiple Choice</mat-option>
                  <mat-option value="true-false">True/False</mat-option>
                </mat-select>
              </mat-form-field>
              <div formArrayName="choices" *ngIf="question.get('type')?.value === 'multiple-choice'">
                <div *ngFor="let choice of getChoices(i).controls; let j = index" [formGroupName]="j" class="form-group">
                  <mat-form-field appearance="fill">
                    <mat-label>Choice {{j + 1}}</mat-label>
                    <input matInput placeholder="Choice {{j + 1}}" formControlName="choiceText" required>
                    <mat-error *ngIf="choice.get('choiceText')?.hasError('required')">Choice is required.</mat-error>
                  </mat-form-field>
                </div>
              </div>
              <mat-form-field appearance="fill">
                <mat-label>Correct Answer</mat-label>
                <input matInput placeholder="Correct Answer" formControlName="correctAnswer" required>
                <mat-error *ngIf="question.get('correctAnswer')?.hasError('required')">Correct Answer is required.</mat-error>
              </mat-form-field>
            </div>
          </div>
          <div>
            <button mat-button type="button" (click)="addQuestion()">Add Another Question</button>
          </div>
          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <p>You are now done.</p>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button (click)="stepper.reset()">Reset</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
  